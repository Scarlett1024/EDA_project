---
title: "EDA Code Notebook Draft"
author: "Dawit Dean, Scarlett Wu"
date: "`r format(Sys.time(), '%e %B %Y')`"
toc: true
format:
  html:
    html-math-method: katex
    code-tools: true
    self-contained: true
    theme: minty
execute:
  warning: false
---

## I. Introduction and Motivation

Bike sharing systems have emerged as a modern alternative to traditional bike rentals, revolutionizing urban mobility with their automated processes for membership, rental, and return. With over 500 bike-sharing programs worldwide, comprising hundreds of thousands of bicycles, these systems play a crucial role in addressing traffic congestion, environmental sustainability, and public health concerns. The rich data generated by these systems, capturing the duration of travel and the departure and arrival positions of users, presents a valuable resource for research and analysis.

The Bike Sharing Dataset, curated by Hadi Fanaee-T at the Laboratory of Artificial Intelligence and Decision Support (LIAAD), University of Porto, Portugal, offers insights into the dynamics of bike sharing systems (Fanaee-T and Gama, 2014) \[1\]. This dataset, sourced from the Capital Bikeshare system in Washington D.C., USA, covers a two-year historical log spanning 2011 and 2012. It provides a comprehensive view of bike rental behaviors, influenced by various environmental and seasonal factors such as weather conditions, precipitation, day of the week, season, and time of day (Dheeru and Karra Taniskidou, 2017) \[2\].

By aggregating the data on both two-hourly and daily bases and integrating corresponding weather and seasonal information extracted from sources like freemeteo.com, the dataset enables in-depth analysis of the intricate interplay between bike sharing usage patterns and external conditions. This unique combination of temporal and environmental data transforms bike sharing systems into virtual sensor networks, capable of monitoring urban mobility and detecting significant events in the city.

In this analysis, we aim to explore the correlations between bike sharing rental patterns and environmental variables, uncovering insights that can inform urban planning, transportation policy-making, and the development of more efficient and sustainable mobility solutions. By leveraging the Bike Sharing Dataset, we can gain a deeper understanding of the dynamics shaping urban transportation systems and contribute to efforts aimed at fostering greener, more accessible cities.

### i. Research Question

What variables have a significant effect on the number of bike rentals?

## II. Bike Sharing Data Set — Data Description and EDA

-   instant: record index

-   dteday : date - season : season (1:springer, 2:summer, 3:fall, 4:winter)

-   yr : year (0: 2011, 1:2012)

-   mnth : month ( 1 to 12) - hr : hour (0 to 23)

-   hr: hour (0 to 23)

-   holiday : weather day is holiday or not (extracted from <http://dchr.dc.gov/page/holiday-schedule)> -

-   weekday : day of the week

-   workingday : if day is neither weekend nor holiday is 1, otherwise is 0.

-   weathersit :

    -   1: Clear, Few clouds, Partly cloudy, Partly cloudy

    -   2: Mist + Cloudy, Mist + Broken clouds, Mist + Few clouds, Mist

    -   3: Light Snow, Light Rain + Thunderstorm + Scattered clouds, Light Rain + Scattered clouds

    -   4: Heavy Rain + Ice Pallets + Thunderstorm + Mist, Snow + Fog

<!-- -->

-   temp: Normalized temperature in Celsius.

-   atemp: Normalized feeling temperature in Celsius.

-   hum: Normalized humidity. The values are divided to 100 (max)

-   windspeed: Normalized wind speed. The values are divided to 67 (max)

-   casual: count of casual users

-   registered: count of registered users

-   cnt: count of total rental bikes including both casual and registered

#### i. Load packages

The library we use for this project are `tidyvers`, **`dplyr`**, and **`ggplot2`**.

While `tidyverse` contains multiple packages for data manipulation and visualization, `dplyr` provides a set of functions that are easy to understand and work with for tasks like filtering rows, selecting columns, mutating data, grouping data, and summarizing data. For visualization specifically, `ggplot2` provides a flexible framework for creating a wide variety of visualizations, from simple scatter plots to complex multi-layered plots with facets and themes.

```{r}
library(tidyverse)
library(dplyr)
library(ggplot2)
library(stargazer)
library(car)
library(lmtest)
library(sandwich)
library(corrplot)
```

#### ii. Import and view the dataset

We start with importing the dataframe and performing initial exploratory data analysis.

The dataset, **`bike_data`**, is read from a CSV file using the **`read.csv()`** function. We then extract the variable names, dimensions, and identify any missing values in the dataset using functions like **`names()`**, **`dim()`**, and **`sum(is.na())`**, respectively. Additionally, we examine the structure of the dataset, including variable types and a preview of the data, using the **`str()`** function.

```{r data_structure}
# read dataset
bike_data <- read.csv("~/Desktop/bike_sharing/EDA_project/data/hour.csv")

# Extract variable names from the dataset
variable_names <- names(bike_data)
print(variable_names)

# Get the dimensions (rows, columns) of the dataset
dataset_dimensions <- dim(bike_data)
print(dataset_dimensions)

# Check the number of missing values
missing_values <- sum(is.na(bike_data))
print(missing_values)

# Display the structure of the dataset, including variable types and a preview of data
str(bike_data)
```

#### iii. EDA: Exploratory Data Analysis

Among the numerous variables within our dataset, we first use "cnt" (count of total rental bikes including both casual and registered) as an example to illustrate the fundamental processes of our analysis. Initially, we examine the central tendencies of the "cnt" variable. Subsequently, we visualize the relationship between this target variable and other variables, shedding light on patterns and potential correlations within the dataset.

1.  Central tendencies

```{r}
# Provide a descriptive summary of the numerical variables and the target variable `cnt`
summary_df <- summary(bike_data[c('temp', 'hum', 'windspeed', 'atemp','cnt')])
# Print the summary statistics
print(summary_df)
```

```{r}
# Recoding 0 to 2011 and 1 to 2012 of the 'yr' variable
by_yr <-bike_data %>%
  mutate(year = recode(yr, 0 == "2011", 1 == "2012"))

# Group the data by year and select columns of interest for analysis
compare_means <- by_yr %>%
  group_by (year) %>%
  select (year, cnt, registered, casual) %>%
  summarise (
    Toal_rental_mean = mean (cnt),             # Calculating mean of total rentals
    mean_registered = mean (registered),       # Calculating mean of registered rentals
    mean_casual_user = mean (casual))          # Calculating mean of casual rentals

# Display the comparison of means
compare_means
```

2.  Visualize the fluctuation in the total number of bike rentals across different seasons, hours of the day, years, and other relevant variables.

```{r}
# Calculate the mean of the target variable 'cnt' by the categorical variable 'season'
means <- aggregate(cnt ~ season, data = bike_data, FUN = mean)

# Create a bar plot using ggplot2 to visualize the mean total rental bike count across seasons
p1 <- ggplot(means, aes(x = season, y = cnt, fill = season)) +
  geom_bar(stat = "identity", width = 0.5, alpha = 0.8) +
  labs(title = "Total Rental Bike Count by Season",
       x = "Seasons",
       y = "Total Rental Bikes") +
  scale_x_continuous(breaks = c(1, 2, 3, 4), labels = c("Spring","Summer","Fall", "Winter")) +
  theme(legend.position = "none")
p1
```

The bar plot reveals trends in total bike rentals across different seasons. Surprisingly, the highest demand for bike rentals is observed during fall, while spring records the lowest usage. This finding contrasts with the common expectation of increased biking activity during springtime. Additionally we observer that there isn't that much a difference between Summer, Fall, and Winter. Thus we can combine those into a single group to simply our model.

```{r}
# Create a scatter plot to visualize the relationship between hour of the day and total rental bike count
p2 <- ggplot(bike_data, aes(x = hr, y = cnt)) +
  geom_point(color = "darkblue", alpha = 0.4) +
  labs(x = "Hour of Day", y = "Rental Bike Count", title = "Relationship Between Hour of Day and Total Rental Bike Count")
p2
```

The scatter plot highlights peaks in total bike rentals, notably at 5 p.m., 6 p.m., and 8 a.m. respectively. This might be due to higher demand during peak commuting hours. These time periods likely coincide with the rush hours when people commute to and from work or school, resulting in a surge in bike rental activity.

```{r}
#| warning: false

# Create a histogram to visualize the distribution of total rental bike count by year
p3 <- ggplot(by_yr, aes(x = cnt)) +
  geom_histogram(color="darkblue", fill="lightblue", binwidth = 60) +
  labs(title = "Total Rental Bike Count by Year",
       x = "Total Rental Bikes")

# Add vertical dashed lines representing the mean of total rental bike count for each year
p3 + geom_vline(aes(xintercept=mean(cnt)),
            color="blue", linetype="dashed", size=1)

# Display histograms for each year using facet_wrap
p3 + facet_wrap(~year)
```

Both distributions are right skewed, indicating that on fewer occasions, there are significantly higher rental bike counts compared to a bulk of days with lower counts. When comparing the two years, 2012 has more bars extending to the right, suggesting an overall increase in rental counts. This observation aligns with our earlier findings regarding central tendency, as the mean total rental bikes in 2012 surpassed that of 2011. This suggests potential growth in the bike rental program or a rising trend in shared-bike usage.

The bar plot illustrates the variations in total bike rentals throughout the days of the week. While the discrepancies are not prominently pronounced, the data suggests that Saturdays and Fridays observe the highest total rental counts.

```{r}
# Create a count plot to visualize total rental bike count by working day
p5 <- ggplot(bike_data, aes(x = workingday, y = cnt, fill = workingday)) +
   geom_bar(stat = "identity", width = 0.3, alpha = 0.7) +
  labs(x = "Working Day", y = "Total Rental Bikes", title = "Total Rental Bike Count by Working Day") + 
  scale_x_continuous(breaks = c(0,1), labels = c("Work Day", "Not Work Day")) +
  theme(legend.position = "none")
p5
```

The bar plot indicates a notable disparity in total rental bike usage between non-workdays and workdays. This observation may suggest that shared bikes are not the primary mode of transportation for commuting to work.

```{r}
# Select the variables for the scatter matrix
set1 <- bike_data[c('hr', 'temp', 'atemp', 'hum', 'cnt', 'casual', 'registered')]

# Create scatter matrix
pairs(set1, main = "Matrix Scatter Plot of Bike Sharing Data")
```

It is not obvious from the graph above that multicollinearity is an issue so we will need to investigate this further.

```{r}
# Assuming 'data' is your dataset
correlation_matrix <- cor(set1, method = "pearson")

# Plot the heatmap
corrplot(correlation_matrix, method = "color", type = "upper", 
         tl.col = "black", tl.srt = 45)
```

From this plot we can visually see that our independent variables are not very correlated with each other. This likely suggest that multicollinearity is not an issue however will verify this later in the analysis using the VIF (variance inflation factor) test.

#### iv. Creating Dummy Variables

```{r}
# collapse levels of seasons -since only spring is the only level that varies
bike_data$isSpring <- ifelse(bike_data$season == 1, 1, 0)

```

## III. Bike Sharing Data Set — Methodology/Empirical Model

### i. Proposed Model:

$$
\text{TotalRentalBikes} = \text{Holiday} + \text{Temp} + \text{Season}
+ \text{Humidity} + \text{Wind_Speed} 
+ \text{Hour} + \text{Working_Day} + \text{Weather_Situation}
$$

-   Holiday: Bike rental patterns may differ on holidays due to changes in people's routines or participation in special events.

-   Temp: Bike rental demand may increase with higher temperatures as people are more likely to engage in outdoor activities.

-   Season: Our Intuition suggests that number of bike rentals may increase during seasons with pleasant weather, such as spring and summer, and decrease during harsh weather conditions in winter; however our EDA analysis demonstrated the opposite.

-   Humidity: High humidity levels may deter people from outdoor activities, potentially reducing bike rental demand.

-   Wind_Speed: Strong winds may affect the comfort and safety of biking, potentially impacting bike rental demand.

-   Hour: The number of bike rentals may vary throughout the day, with peak rental times during rush hours or leisure hours.

-   Working_Day: Bike rental patterns may be influenced by people's work schedules, with higher rentals on non-working days.

-   Weather_Situation: Weather conditions can significantly impact bike rental demand, with fewer rentals during adverse weather conditions like rain or snow.

### ii. Econometric Model:

$$
\text{TotalRentalBikes} = \beta_0 + \beta_1 \text{Holiday} + \beta_2 \text{Temp} + \beta_3 \text{Season_summer} + \beta_4 \text{Season_Fall} + \beta_5 \text{Season_Winter}
+ \beta_6 \text{Humidity} \\ + \beta_7 \text{Wind_Speed} 
+ \beta_8 \text{Hour} + \beta_9 \text{Working_Day} + \beta_9 \text{Weather_Situation_L2} + \beta_{10} \text{Weather_Situation_L3} + \beta_{11} \text{Weather_Situation_L4}
$$

```{r, output=FALSE}
# running proposed models
cnt1 <- lm(cnt ~ temp, data = bike_data)
cnt2 <- step(lm(cnt ~ temp + hum, data = bike_data))
cnt3 <- step(lm(cnt ~ temp + hum + holiday, data = bike_data))
cnt4 <- step(lm(cnt ~ temp + hum + holiday + isSpring, data = bike_data))
cnt5 <- step(lm(cnt ~ temp + hum + holiday + isSpring + windspeed, data = bike_data))
cnt6 <- step(lm(cnt ~ temp + hum + holiday + isSpring + windspeed + hr, data = bike_data))
cnt7 <- step(lm(cnt ~ temp + hum + holiday + isSpring + windspeed + hr + workingday, data = bike_data))
```

```{r}
# put in stargazer
stargazer(cnt1, cnt2, cnt3, cnt4, cnt5, cnt6, cnt7, 
          type = "text", 
          title = "Forward Stepwise Linear Regression Results", 
          covariate.labels = c("Temp", "weathersit", "hum", "holiday", "season", "windspeed", "hr", "workingday"),
          column.labels = c("Model 1", "Model 2", "Model 3", "Model 4", "Model 5", "Model 6", "Model 7", "Model 8"),
          dep.var.labels.include = FALSE)
```

## IV. Bike Sharing Data Set — Results and Assessments

### i. Assumption 3: Test for Perfect Collinearity/Multicollinearity

```{r}
# Calculate VIF
vif_values <- vif(cnt7)

# View VIF values
print(vif_values)
```

We do not observe a high variable inflation factor as all the VIF values are below 10. Our VIF scores are around 1, which indicates that our variables are not correlated. We have moderately low R2 and low standard errors for all regressors in each specification, indicating that our model is accurate without significant collinearity concerns.

### ii. Assumption 4: Test for heteroscedasticity

```{r}
# Perform Breusch-Pagan test for heteroscedasticity
bp_test <- bptest(cnt7)
bp_test
```

Running the Bresuch-Pagan Test does not indicate the presence of heteroskedasticity in our model. Our p-value is extremely small, so we reject the null hypothesis of homoskedasticity. Thus we must adjust our model for heteroskedasticity.

### iii. Adjust Model for Heteroskedasticity — Weighted Least Squares

```{r}
vcov <- vcovHC(cnt7, type = "HC0")
sqrt(diag(vcov))

coeftest(cnt7, vcov. = vcov)
summary(cnt7)
```

## V. Conclusion and Implications

Our transformed model shows the three largest factors that impact bike rentals are temperature, humidity, and if the season is Spring.

Holding all else equal, an additional unit increase in temperature results in an increase of 262.9305 bikes rented. Moreover, an additional unit increase in humidity results in a decrease of 224.8495 bikes rented—ceteris paribus. Our third largest factor, isSpring, suggests that if the season is Spring we expect on average a decrease of 49.1083 bikes rented—ceteris paribus.

Our model highlights the variables that have a significant impact on the bike sharing rental behaviors. The insights from this model enables uban planners and transportation policy-making to develop more efficient and sustainable mobility solutions.

Through exploratory data analysis techniques, we've examined various aspects of the dataset, including descriptive statistics, distributions, and relationships between variables. This codebook serves as a resource for understanding the dataset and identifying areas for further investigation. Moving forward, we can delve deeper into specific patterns, trends, and correlations within the data, such as different rental behaviors between casual and registered users in different geographic conditions. Additionally, we can explore predictive modeling techniques to forecast rental demand and optimize bike-sharing services.

## VI. References

\[1\] Fanaee-T, H., & Gama, J. (2013). Event labeling combining ensemble detectors and background knowledge. *Progress in Artificial Intelligence*, *2*(2–3), 113–127. https://doi.org/10.1007/s13748-013-0040-3

\[2\] Dheeru and E. Karra Taniskidou. (2017). UCI machine learning repository. http://archive.\
ics.uci.edu/ml
